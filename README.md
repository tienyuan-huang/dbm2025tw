# **拉罷地圖工具 (Recall Map Tool)**

這是一個前端視覺化專案，旨在協助罷免案志工、政治工作者或任何關心台灣政治的公民，透過互動式地圖與數據圖表，分析歷年地方選舉的村里層級數據，以制定更有效的溝通與拉票策略。

## **✨ 主要功能**

* **多模式選舉分析**：  
  * **一般選舉模式**：可自由切換分析 2012 至 2024 年間的「總統」、「立法委員」、「縣市長」與「政黨票」選舉資料。  
  * **(新) 罷免案分析模式**：專為 2025 年罷免案設計，提供獨特的視覺化與歷史趨勢對比功能。  
* **互動式地圖 (使用 [Leaflet.js](https://leafletjs.com/))**：  
  * 根據選舉結果的政黨傾向或罷免案的立場進行顏色編碼。  
  * **票倉視覺化**：村里區塊的透明度根據該地「選舉人數佔選區總人數的比例」分級。佔比越高的村里（票倉），顏色越不透明，讓您輕易識別出選區內的關鍵區域。  
  * **動態圖層控制**：可自由開關不同政黨傾向、激戰區與搖擺區的圖層可見度。  
  * **清晰標示**：可選擇是否在地圖上顯示村里名稱，標籤採黑字白邊樣式，縮放時依然清晰易讀。  
* **深度數據儀表板 (使用 [Chart.js](https://www.chartjs.org/))**：  
  * **關鍵指標**：包含「催票率」與「未投票率」，幫助評估候選人基本盤實力與潛在動員空間。  
  * **歷史趨勢分析**：  
    * 在一般模式下，以折線圖呈現單一村里歷年選舉中，各主要政黨的「催票率」消長趨勢，並整合縣市長選舉資料作為參考。  
    * 在罷免案模式下，將 2025 年「同意/不同意」方的催票率，與該村里歷屆選舉中「挑戰者/現任者」政黨的催票率進行對比，深入分析動員能量來源。  
  * **搖擺區識別**：  
    * **高度搖擺區** (一般模式)：地圖上以**黃色外框**標示出在歷次選舉中政黨傾向轉變頻繁的村里。  
    * **本次搖擺區** (罷免案模式)：地圖上以**黃色漸變閃爍外框**標示出與 2024 年立委選舉結果相比，立場發生轉變的村里。  
  * **人口結構分析**：顯示特定村里的年齡與性別結構（人口金字塔），有助於了解地方的人口組成與潛在社會需求。  
* **個人化與匯出**：  
  * 使用者可針對感興趣的村里新增、編輯或刪除個人註解，並以圖釘顯示在地圖上。  
  * 可將選定選區內所有村里的分析資料與個人註解，一併匯出為 .CSV 或 .KML 格式。  
* **引導式分析流程與響應式設計 (RWD)**：  
  * 從選擇選舉類型到深入村里詳情，提供清晰的四步驟引導。  
  * 介面已針對桌面與行動裝置進行優化，提升跨裝置的操作體驗。

## **📂 專案結構與資料說明**

本專案為純前端應用，無需後端伺服器。所有資料皆存放於 data 資料夾中。  
.  
├── index.html         \# 主要 HTML 檔案  
├── script.js          \# 主要 JavaScript 邏輯  
├── README.md          \# 本說明文件  
└── data/  
    ├── village.json   \# TopoJSON 格式的台灣村里地理圖資  
    ├── 2024/  
    │   ├── regional\_legislator\_votes.csv  
    │   ├── president\_votes.csv  
    │   ├── party\_votes.csv  
    │   └── U01VI-2024M12-TW.csv  \# 人口統計資料  
    ├── 2022/  
    │   └── mayor\_votes.csv  
    ├── 2020/  
    │   └── ... (以此類推)  
    └── 2025/  
        └── 20250726\_village.csv  \# 罷免案投票結果

### **CSV 資料欄位定義**

為了讓 script.js 能正確解析，請確保所有選舉資料的 CSV 檔案都包含以下標準欄位：  
**1\. 一般選舉 (立委、縣市長、總統、政黨票)**

| 欄位名稱 | 資料類型 | 說明 | 範例 |
| :---- | :---- | :---- | :---- |
| geo\_key | String | **\[必要\]** 村里代碼 (主鍵) | 10017020006 |
| county\_name | String | 縣市名稱 | 基隆市 |
| township\_name | String | 鄉鎮市區名稱 | 七堵區 |
| village\_name | String | 村里名稱 | 八德里 |
| electoral\_district\_name | String | 選舉區名稱 (僅立委需要) | 基隆市第01選區 |
| candidate\_name | String | 候選人姓名 (政黨票模式下此欄位可為空) | 林沛祥 |
| party\_name | String | 政黨名稱 | 中國國民黨 |
| votes | Number | 該候選人/政黨在此村里的得票數 | 1350 |
| electorate | Number | **\[必要\]** 該村里總選舉人數 | 3500 |
| total\_votes | Number | **\[必要\]** 該村里總投票數 (有效+無效) | 2800 |

**2\. 罷免案 (20250726\_village.csv)**

| 欄位名稱 | 資料類型 | 說明 | 範例 |
| :---- | :---- | :---- | :---- |
| geo\_key | String | **\[必要\]** 村里代碼 (主鍵) | 10017020006 |
| county\_name | String | 縣市名稱 | 基隆市 |
| township\_name | String | 鄉鎮市區名稱 | 七堵區 |
| village\_name | String | 村里名稱 | 八德里 |
| electoral\_district\_name | String | **\[必要\]** 選舉區名稱 | 基隆市第01選區 |
| Agree | Number | **\[必要\]** 同意罷免票數 | 279 |
| Disagree | Number | **\[必要\]** 不同意罷免票數 | 387 |
| electorate | Number | **\[必要\]** 該村里總選舉人數 | 1386 |
| total\_votes | Number | **\[必要\]** 該村里總投票數 | 672 |

## **💻 程式碼架構概覽 (script.js)**

為了方便維護與擴充，script.js 的主要邏輯圍繞以下核心函式展開：

* **初始化與事件監聽 (initialize..., setupEventListeners)**: 設定地圖、圖表與所有 UI 元件的初始狀態及互動事件。  
* **資料處理 (processVoteData, loadAllWinners, calculate...)**: 負責讀取、解析 CSV 資料，並計算各種分析所需的指標（如：催票率、搖擺區等）。  
* **主流程控制 (selectElectionCategory, loadAndDisplayYear, handleDistrictSelection)**: 管理使用者從選擇選舉類型到檢視地圖的整個流程。  
* **UI 渲染 (renderMapLayers, renderDistrictOverview, renderVillageDetails)**: 根據處理好的資料，將地圖、圖表與詳細資訊面板動態繪製到畫面上。  
* **罷免案專用分析 (renderRecallHistoricalAnalysis, calculateRecallSwing)**: 處理罷免案模式下獨有的歷史對比與本次搖擺區計算邏輯。

## **🎯 已知限制與未來展望**

* **圖資年份限制**：本工具統一採用 **2025 年**之村里界圖資。在解讀 2024 年（含）以前的歷史資料時，需注意可能因行政區重劃造成的誤差。  
* **2012 年資料限制**：因 2012 年的行政區劃與現行圖資差異過大，該年份的資料**無法繪製村里地圖**，但仍可查看選區級別的總覽數據。  
* **BETA 功能**：罷免案分析為新上線功能，資料與分析結果僅供參考，一切應以中央選舉委員會的官方公告為準。

## **🛠️ 技術棧**

* **地圖**: [Leaflet.js](https://leafletjs.com/)  
* **圖表**: [Chart.js](https://www.chartjs.org/)  
* **前端框架/函式庫**: Vanilla JavaScript, [Tailwind CSS](https://tailwindcss.com/)  
* **資料解析**: [PapaParse](https://www.papaparse.com/)  
* **地理資料格式**: [TopoJSON](https://github.com/topojson/topojson)
